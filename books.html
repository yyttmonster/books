<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Book Memoirs</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link href="source/css/books.css" rel="stylesheet" type="text/css">
    <script src="source/js/jQuery.min.js"></script>
    <script src="source/js/three.js"></script>
    <script src="source/js/Tween.js"></script>
    <script src="source/js/TrackballControls.js"></script>
    <script src="source/js/CSS3DRenderer.js"></script>
</head>
<body>
<div id="container"></div>
<div id="menu">
    <button id="table">TABLE</button>
    <button id="helix">HELIX</button>
    <!--room for searching niput!-->
</div>
<script>
    var table = [
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],
        ["围城", "钱钟书", "2016", "",1,1],
        ["明朝那些事儿", "当年明月", "",2,1],


    ];

    var camera, scene, renderer;
    var controls;
    var objects = [];
    var targets = {table: [], helix: []};
    init();
    animate();

    function init() {
        camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 1, 1000);
        camera.position.z = 3000;
        scene = new THREE.Scene();
        for (var i = 0; i < table.length; i++) {
            // book div
            var element = document.createElement("div");
            element.className = "element";
            element.style.backgroundColor = "rgba(0,127,127," + (Math.random() * 0.5 + 0.25) + ")";

            // number
            var number = document.createElement("div");
            number.className = "number";
            number.textContent = i + "";
            element.appendChild(number);

            // name div
            var book_name = document.createElement("div");
            book_name.className = "book_name";
            book_name.textContent = table[i][0];
            element.appendChild(book_name);

            // author
            var author = document.createElement("div");
            author.className = "author";
            author.textContent = table[i][1];
            element.appendChild(author);

            var object = new THREE.CSS3DObject(element);
            object.position.x = Math.random() * 4000 - 2000;
            object.position.y = Math.random() * 4000 - 2000;
            object.position.z = Math.random() * 4000 - 2000;
            scene.add(object);
            objects.push(object);

            var object = new THREE.Object3D();
            object.position.x = (table[i][4] *140)-1330;
            object.position.y = -(table[i][5]*180)+990;

            targets.table.push(object);
        }

        var vector = new THREE.Vector3();
        for ( var i = 0, l = objects.length; i < l; i ++ ) {
            var theta = i * 0.175 + Math.PI;
            var y = - ( i * 8 ) + 450;
            var object = new THREE.Object3D();
            object.position.setFromCylindricalCoords( 900, theta, y );
            vector.x = object.position.x * 2;
            vector.y = object.position.y;
            vector.z = object.position.z * 2;
            object.lookAt( vector );
            targets.helix.push( object );
        }

        renderer = new THREE.CSS3DRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById("container").appendChild(renderer.domElement);

        controls = new THREE.TrackballControls(camera, renderer.domElement);
        controls.rotateSpeed = 0.5;
        controls.minDistance = 500;
        controls.maxDistance = 6000;
        controls.addEventListener("change", render);

        var button = document.getElementById("helix");
        button.addEventListener("click", function () {
            transform(targets.helix, 2000);
        },false);

        var button = document.getElementById("table");
        button.addEventListener("click", function () {
            transform(targets.table, 2000);
        },false);
        transform(targets.helix, 2000);

        window.addEventListener("resize", onWindowResize, false)

    }

    function transform(targets, duration) {
        TWEEN.removeAll();
        for (var i = 0; i < objects.length; i++) {
            var object = objects[i];
            var target = targets[i];
            new TWEEN.Tween(object.position)
                .to({x: target.position.x, y: target.position.y, z: target.position.z}, Math.random() * duration)
                .easing(TWEEN.Easing.Exponential.InOut)
                .start();
            new TWEEN.Tween(object.rotation)
                .to({x: target.rotation.x, y: target.rotation.y, z: target.rotation.z}, Math.random() * duration)
                .easing(TWEEN.Easing.Exponential.InOut)
                .start();
        }
        new TWEEN.Tween(this)
            .to({}, duration * 2)
            .onUpdate(render)
            .start();
    }

    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        render();
    }

    function animate() {
        requestAnimationFrame(animate);
        TWEEN.update();
        controls.update();
    }

    function render() {
        renderer.render(scene, camera)
    }


</script>


</body>
</html>